---
layout: post
title: 'How To: Enable Unity in a SharePoint application guidance just released'
categories:
- Dependency Injection
- MVP Pattern
- p&amp;p
- Patterns &amp; Practices
- SharePoint
- Unit Tests
- Unity
- WSS 3.0
tags:
- Dependency Injection
- MVP Pattern
- p&amp;p
- Patterns &amp; Practices
- SharePoint
- Unit Tests
- Unity
- WSS 3.0
status: publish
comments: true
type: post
published: true
meta:
  _edit_last: '15'
  dsq_thread_id: '1600014072'
author:
  login: dschenkelman
  email: damian.schenkelman@gmail.com
  display_name: Damian Schenkelman
  first_name: Damian
  last_name: Schenkelman
---
<p>A new guidance to help developers enable <a href="http://msdn.microsoft.com/en-us/library/cc440939.aspx" target="_blank">Unity</a> in a SharePoint application has just been released by the Patterns &amp; Practices Sustained Engineering team. You can download the release from the  <a href="http://www.codeplex.com/websf/Release/ProjectReleases.aspx?ReleaseId=17134" target="_blank">Web Client Software factory codeplex site</a>.</p>
<p>In the release, the base <strong>SPHttpApplication </strong>class is customized by using it as the parent class of the <strong>SPUnityHttpApplication </strong>class.</p>
<p>The main feature this class has, to enable the <strong>Unity</strong> container, is the <strong>BuildItemWithCurrentContext</strong> method. Below is the code for this method:</p>
<pre><span style="color: blue">public static void </span>BuildItemWithCurrentContext(<span style="color: blue">object </span>obj)
{
      <span style="color: #2b91af">HttpContext </span>context = System.Web.<span style="color: #2b91af">HttpContext</span>.Current;
      Unity.SharePoint.<span style="color: #2b91af">SPUnityHttpApplication </span>app =
         (Unity.SharePoint.<span style="color: #2b91af">SPUnityHttpApplication</span>)context.ApplicationInstance;
      app.Container.BuildUp(obj.GetType(), obj);
}</pre>
<p><a href="http://11011.net/software/vspaste"></a><a href="http://11011.net/software/vspaste"></a></p>
<p>The objective of  enabling the <strong>Unity</strong> container is holding the different elements of your application to perform dependency injection into your classes.</p>
<p>Custom <strong>Web Part</strong> and<strong> User Control</strong> classes are created in the release to enable them for Dependency Injection. This will give your classes a low coupling level, since there will be no hard references between them. Given that, you can perform unit tests in an easy manner.</p>
<p>To increase the testing capabilities even more, the <a href="http://msdn.microsoft.com/en-us/library/cc304760.aspx" target="_blank">Model-View-Presenter pattern</a> is used in this example. The objective of this pattern is placing all complex UI logic in a presenter class, thus it is easier to test. The image below (from the MSDN Web Client Software Factory site) shows the relationship between the different components in the pattern.</p>
<p><a href="http://blogs.southworks.net/dschenkelman/files/2008/09/mvp.png"><img src="http://blogs.southworks.net/dschenkelman/files/2008/09/mvp-thumb.png" border="0" alt="MVP" width="201" height="244" /></a></p>
<p>We also posted the complete guidance <a href="http://www.codeplex.com/websf/Wiki/View.aspx?title=How%20To%3a%20Enable%20Unity%20in%20a%20SharePoint%20Application%20to%20make%20Web%20Parts%20more%20testable&amp;referringTitle=SharePoint" target="_blank">here</a> for online reference. It contains the following topics:</p>
<ul>
<li>How To: Enable Unity in a SharePoint Application</li>
<li>How To: Create a Web Part that uses Dependency Injection</li>
<li>How To: Unit test the Web Part</li>
<li>How To: Deploy the Web Part</li>
</ul>
<p>If you want more info about SharePoint you can check:</p>
<ul>
<li><a href="http://blogs.southworks.net/mconverti/2008/09/10/enabling-cwab-and-unity-in-sharepoint-applications-sets-of-guidance-published/" target="_blank">Enabling CWAB and Unity in Sharepoint Applications sets of guidance</a> written by <a href="http://blogs.southworks.net/mconverti">Mariano Converti</a></li>
<li><a href="http://blogs.msdn.com/francischeung/archive/2008/08/22/unit-testing-sharepoint-2007-applications.aspx" target="_blank">Unit Testing SharePoint 2007 Applications</a> written by <a href="http://blogs.msdn.com/francischeung/">Francis Cheung</a></li>
<li><a href="http://www.codeplex.com/spg">The SharePoint guidance codeplex site</a></li>
</ul>
<p>The next post will cover the guidance to enable <strong>CWAB</strong> in a <strong>SharePoint</strong> Application, stay tuned.</p>
<div id="41d08cfa-4c05-4404-a9ca-d3532b0e005e" class="wlWriterSmartContent" style="padding-right: 0px;padding-left: 0px;float: none;padding-bottom: 0px;margin: 0px;padding-top: 0px">Technorati Tags: <a rel="tag" href="http://technorati.com/tags/Unity">Unity</a>,<a rel="tag" href="http://technorati.com/tags/Dependency%20Injection">Dependency Injection</a>,<a rel="tag" href="http://technorati.com/tags/SharePoint">SharePoint</a>,<a rel="tag" href="http://technorati.com/tags/WSS%203.0">WSS 3.0</a>,<a rel="tag" href="http://technorati.com/tags/p&amp;p">p&amp;p</a>,<a rel="tag" href="http://technorati.com/tags/Patterns%20&amp;%20Practices">Patterns &amp; Practices</a>,<a rel="tag" href="http://technorati.com/tags/MVP%20Pattern">MVP Pattern</a>,<a rel="tag" href="http://technorati.com/tags/Unit%20Tests">Unit Tests</a></div>
