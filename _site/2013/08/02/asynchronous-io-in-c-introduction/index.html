<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Asynchronous I/O in C#: Introduction &#8211; A sea of code</title>
<meta name="description" content="Pseudo-random thoughts related to software development...">
<meta name="keywords" content="C#">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/site-logo.jpg">
<meta name="twitter:title" content="Asynchronous I/O in C#: Introduction">
<meta name="twitter:description" content="Pseudo-random thoughts related to software development...">
<meta name="twitter:creator" content="@dschenkelman">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Asynchronous I/O in C#: Introduction">
<meta property="og:description" content="Pseudo-random thoughts related to software development...">
<meta property="og:url" content="/2013/08/02/asynchronous-io-in-c-introduction/">
<meta property="og:site_name" content="A sea of code">





<link rel="canonical" href="/2013/08/02/asynchronous-io-in-c-introduction/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="A sea of code Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.min.css">
<!-- Webfonts -->
<script src="//use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">j

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
	        
			<li>
				
					<a href="/">Home</a>
				 
			</li>
	        
			<li>
				
					<a href="/about/">About</a>
				 
			</li>
	        
			<li>
				
					<a href="/articles/">Articles</a>
				 
			</li>
	        
	        <li><a href="/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
	        <li class="dosearch"><i class="icon-search"></i> Search</li>
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<div class="search-wrapper">
	<div class="search-form">
		<input type="text" class="search-field" placeholder="Search...">
		<i class="icon-remove-sign icon-2x"></i>
		<ul class="search-results post-list"></ul><!-- /.search-results -->
	</div><!-- /.search-form -->
</div><!-- ./search-wrapper -->

<header class="masthead">
	<div class="wrap">
        
    		<a href="/" class="site-logo" rel="home" title="A sea of code"><img src="/images/site-logo.jpg" width="200" height="200" alt="A sea of code logo" class="animated fadeInUp"></a>
        
        <h1 class="site-title animated fadeIn"><a href="/">A sea of code</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">Pseudo-random thoughts related to software development...</h2>
	</div>
</header><!-- /.masthead -->


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <span class="entry-tags"><a href="/tags/#C#" title="Pages tagged C#">C#</a></span>
        
          <h1 class="entry-title">Asynchronous I/O in C#: Introduction</h1>
        
      </header>
      <footer class="entry-meta">
        <img src="/images/bio-photo.jpg" alt="Damian Schenkelman photo" class="author-photo">
        <span class="author vcard">By <span class="fn"><a href="/about/" title="About Damian Schenkelman">Damian Schenkelman</a></span></span>
        <span class="entry-date date published"><time datetime="2013-08-02T00:00:00-04:00"><i class="icon-calendar-empty"></i> August 02, 2013</time></span>
        
        <span class="entry-comments"><i class="icon-comment-alt"></i> <a href="#disqus_thread">Comment</a></span>
        <span><a href="/2013/08/02/asynchronous-io-in-c-introduction/" rel="bookmark" title="Asynchronous I/O in C#: Introduction"><i class="icon-link"></i> Permalink</a></span>
        
      </footer>
      <div class="entry-content">
        <p>Last week with <a href="http://blogs.southworks.net/mconverti" target="_blank">Mariano Converti</a>, we gave the first in a series of presentations related to how asynchronous I/O works in C#. The idea is to start from the low level components that allow asynchronous I/O to take place and to finish with how the <a href="http://msdn.microsoft.com/en-us/library/vstudio/hh191443.aspx" target="_blank">async/await</a><em> </em>constructs work. As each of the presentations takes place, either Mariano or I will write a blog post summarizing the core concepts and also providing a link to a GitHub repo with all the samples.</p>
<p>In this introductory post, I would like to go over some of the benefits of using asynchronous I/O together with some of the drawbacks.</p>
<h2>Why should you care?</h2>
<p>Simply put:</p>
<blockquote><p>Asynchronous I/O does not block the thread while performing operations such as disk or network access.</p></blockquote>
<p>This is really important, as there is a huge difference (orders of magnitude) in the access time between accessing main memory and retrieving something from the network as this <a href="http://serverfault.com/questions/238417/are-networks-now-faster-than-disks" target="_blank">Stack Overflow answer explains</a>.</p>
<p>Whenever you perform a synchronous I/O operation the executing thread is idle waiting for the operation to complete. The worse thing is that when waiting for the operation to complete it is doing nothing, <strong>but it cannot perform any other work!</strong> So in the meantime, if it is a UI thread your UI will be blocked, and if it is a thread from the IIS Thread Pool it won’t be able to process any other requests.</p>
<h2>An enlightening example</h2>
<p>Let’s take the following figure as an example (I’m using IIS for the example as the UI blocking one is something all of you have probably seen). The drawing on the left represents an IIS Thread Pool thread that only performs synchronous I/O. The one on the right represents a similar thread, which uses asynchronous I/O.</p>
<p>Let’s assume that 100 requests come in simultaneously, that we only have one thread to serve all of them and that each request that comes in follows this sequence:</p>
<ol>
<li>Get request and process: 5 ms.</li>
<li>Read from DB: 490 ms.</li>
<li>Process and provide response: 5 ms.</li>
</ol>
<p><strong>Important</strong>: The example is really simple, but it does help illustrate a point.</p>
<p><a href="http://blogs.southworks.net/dschenkelman/files/2013/08/image.png"><img style="padding-left: 0px;padding-right: 0px;padding-top: 0px;border: 0px" title="image" alt="image" src="http://blogs.southworks.net/dschenkelman/files/2013/08/image_thumb.png" width="618" height="360" border="0" /></a></p>
<p><strong>Note</strong>: If the math is incorrect, please leave a comment and I will fix the error. It’s over 1 AM so I could have made a mistake.</p>
<p>It is easy to see from the figure that the thread that uses synchronous I/O can only reply to two of those requests in one second.</p>
<p>On the other hand, the one that takes advantage of asynchronous I/O could reply to all 100 of them.</p>
<p>Yes, that is 50 times more, which begs the question…</p>
<h2>Why haven’t you been using this everywhere?</h2>
<p>Before the <em><a href="http://msdn.microsoft.com/en-us/library/vstudio/hh191443.aspx" target="_blank">async/await</a></em> constructs were available in C# (which are commonly used together with the Task-based asynchronous pattern or <a href="http://msdn.microsoft.com/en-us/library/jj152938.aspx" target="_blank">TAP</a>), performing asynchronous I/O required the usage of patterns such as the asynchronous programming model (<a href="http://msdn.microsoft.com/en-us/library/ms228963.aspx" target="_blank">APM</a>) the event-based asynchronous pattern (<a href="http://msdn.microsoft.com/en-us/library/ms228969.aspx" target="_blank">EAP</a>) and the <em>plain</em> TAP (plain = without <em>async/await</em>). All of them require coders to split the I/O access code between the instructions prior to the operations and those that deal with the result (either through the use of callbacks, events or continuations). For example, to read contents from a file using the APM you would need code like this:</p>
<code data-gist-id="e0f78a13a9298120efd0" data-gist-file="AsyncMain.cs"></code>
<p>You can’t deny that the above seems like a bit too much to read the contents from a file. Doesn’t the following blocking code look much cleaner?</p>
<code data-gist-id="e0f78a13a9298120efd0" data-gist-file="SyncMain.cs"></code>
<p>Well, it does… but is also blocks. Which leads to the following conclusion:</p>
<blockquote><p>Not all I/O operations <strong>need </strong>to be asynchronous. Before going for asynchrony, consider what it implies.</p></blockquote>
<h2>Coming Soon…</h2>
<p>The <em><a href="http://msdn.microsoft.com/en-us/library/vstudio/hh191443.aspx" target="_blank">async/await</a></em> constructs do allow you to write code that looks like the second sample, while getting to keep the benefits of the first one.</p>
<code data-gist-id="e0f78a13a9298120efd0" data-gist-file="ReadFromFile.cs"></code>
<p>The fact that this constructs are so <span style="text-decoration: line-through">magical</span> powerful means that developers don’t need completely understand how things are working under the hood. Nevertheless, in many scenarios it is important to understand how this operations work in order to take full advantage of them and use them correctly.</p>
<p>The next blog post, based on the first talk, will deal with a kind of low level component that is heavily used in Windows to support asynchronous I/O: <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365198(v=vs.85).aspx" target="_blank">I/O Completion Ports</a>.</p>

        <div id="disqus_thread"></div><!-- /#disqus_thread -->
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="/2013/07/17/intro-to-owin-talk-and-a-simple-ip-filtering-middleware-sample/" class="btn" title="Intro to OWIN talk and a simple IP filtering middleware sample">Previous article</a>
      
      
        <a href="/2013/08/04/fakewin8-easy-fakes-for-windows-store-apps-unit-tests/" class="btn" title="fakewin8: Easy fakes for Windows Store apps unit tests">Next article</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2014 Damian Schenkelman. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/so-simple/">So Simple Theme</a>.</span>
<div class="social-icons">
	<a href="http://twitter.com/dschenkelman" title="Damian Schenkelman on Twitter" target="_blank"><i class="icon-twitter icon-2x"></i></a>
	
	
	<a href="http://linkedin.com/in/damianschenkelman" title="Damian Schenkelman on LinkedIn" target="_blank"><i class="icon-linkedin icon-2x"></i></a>
	
	
	
	<a href="http://github.com/dschenkelman" title="Damian Schenkelman on Github" target="_blank"><i class="icon-github icon-2x"></i></a>
	
</div><!-- /.social-icons -->
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/gist-embed/1.7/gist-embed.min.js"></script>


<!-- Jekyll Simple Search option -->
<script>
  $(document).ready(function() {
      $('.search-field').simpleJekyllSearch({
          jsonFile : '/search.json',
          searchResults : '.search-results',
          template : '<li><article><a href="{url}">{title} <span class="entry-date"><time datetime="{date}">{shortdate}</time></span></a></article></li>',
          noResults: '<p>Nothing found.</p>'
        });
  });

  (function( $, window, undefined ) {

     var bs = {
          close: $(".icon-remove-sign"),
          searchform: $(".search-form"),
          canvas: $("body"),
          dothis: $('.dosearch')
      };

    bs.dothis.on('click', function() {
      $('.search-wrapper').css({ display: "block" });
      bs.searchform.toggleClass('active');
      bs.searchform.find('input').focus();
      bs.canvas.toggleClass('search-overlay');
    });

      bs.close.on('click', function() {
        $('.search-wrapper').removeAttr( 'style' );
        bs.searchform.toggleClass('active');
        bs.canvas.removeClass('search-overlay');
    });
  })( jQuery, window );
</script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-50875301-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'dschenkelman'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	        

</body>
</html>
