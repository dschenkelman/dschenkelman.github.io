<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Needle Container: Fluency and Mapping Types &#8211; A sea of code</title>
<meta name="description" content="Pseudo-random thoughts related to software development...">
<meta name="keywords" content="Dependency Injection, Needle">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://localhost:4000/images/site-logo.jpg">
<meta name="twitter:title" content="Needle Container: Fluency and Mapping Types">
<meta name="twitter:description" content="Pseudo-random thoughts related to software development...">
<meta name="twitter:creator" content="@dschenkelman">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Needle Container: Fluency and Mapping Types">
<meta property="og:description" content="Pseudo-random thoughts related to software development...">
<meta property="og:url" content="http://localhost:4000/2011/07/18/needle-container-fluency-and-mapping-types/">
<meta property="og:site_name" content="A sea of code">





<link rel="canonical" href="http://localhost:4000/2011/07/18/needle-container-fluency-and-mapping-types/">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="A sea of code Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.min.css">
<!-- Webfonts -->
<script src="//use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://localhost:4000/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/gist-embed/1.7/gist-embed.min.js"></script>

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
	        
			<li>
				
					<a href="http://localhost:4000/">Home</a>
				 
			</li>
	        
			<li>
				
					<a href="http://localhost:4000/about/">About</a>
				 
			</li>
	        
			<li>
				
					<a href="/articles/">Articles</a>
				 
			</li>
	        
	        <li><a href="http://localhost:4000/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
	        <li class="dosearch"><i class="icon-search"></i> Search</li>
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<div class="search-wrapper">
	<div class="search-form">
		<input type="text" class="search-field" placeholder="Search...">
		<i class="icon-remove-sign icon-2x"></i>
		<ul class="search-results post-list"></ul><!-- /.search-results -->
	</div><!-- /.search-form -->
</div><!-- ./search-wrapper -->

<header class="masthead">
	<div class="wrap">
        
    		<a href="http://localhost:4000/" class="site-logo" rel="home" title="A sea of code"><img src="http://localhost:4000/images/site-logo.jpg" width="200" height="200" alt="A sea of code logo" class="animated fadeInUp"></a>
        
        <h1 class="site-title animated fadeIn"><a href="http://localhost:4000/">A sea of code</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">Pseudo-random thoughts related to software development...</h2>
	</div>
</header><!-- /.masthead -->


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <span class="entry-tags"><a href="http://localhost:4000/tags/#Dependency Injection" title="Pages tagged Dependency Injection">Dependency Injection</a>&nbsp;&bull;&nbsp;<a href="http://localhost:4000/tags/#Needle" title="Pages tagged Needle">Needle</a></span>
        
          <h1 class="entry-title">Needle Container: Fluency and Mapping Types</h1>
        
      </header>
      <footer class="entry-meta">
        <img src="http://localhost:4000/images/bio-photo.jpg" alt="Damian Schenkelman photo" class="author-photo">
        <span class="author vcard">By <span class="fn"><a href="http://localhost:4000/about/" title="About Damian Schenkelman">Damian Schenkelman</a></span></span>
        <span class="entry-date date published"><time datetime="2011-07-18T00:00:00-04:00"><i class="icon-calendar-empty"></i> July 18, 2011</time></span>
        
        
        <span><a href="http://localhost:4000/2011/07/18/needle-container-fluency-and-mapping-types/" rel="bookmark" title="Needle Container: Fluency and Mapping Types"><i class="icon-link"></i> Permalink</a></span>
        
      </footer>
      <div class="entry-content">
        <p><a href="http://blogs.southworks.net/dschenkelman/2011/02/18/needle-dependency-injection-container-alpha-0-1-version-released/">Back in February</a>, I blogged about <a href="http://needlecontainer.codeplex.com/">Needle</a>, a dependency injection container that I was developing. In that post, I listed some of the most relevant features Needle has, one of them being its Fluent API. I thought it would be a would idea to talk about Needle again, but this time sharing some code and ideas behind it.</p>
<h3>First things first, why do I want fluency?</h3>
<p>This is of course a matter of appreciation, but I personally relate fluency to both ease of use and readability. Interestingly enough one of them is important before writing the code, and the other one after doing so. The idea is that a fluent API will give you a small set of options when performing a particular operation, each of them will be presented at the correct moment, and that once the code has been written, you can explain it to your non-tech grandma.</p>
<h3>Our fluent scenario, mapping types</h3>
<p>A really common operation that needs to be performed when working with DI containers is mapping types, which involves configuring the container to determine the type you want to get when requesting another type. This is commonly used by mapping an interface to a concrete implementation.</p>
<p>Let’s say we have an <strong>IForceEnlightened</strong> interface, and a <strong>Jedi</strong> class which implements that interface. If we wanted to get a <strong>Jedi</strong> whenever we request an instance of <strong>IForceEnlightened </strong>from the container, we can write the following code:</p>
<code data-gist-id="5f417134279a7e3f584d" data-gist-file="Sample.cs"></code>
<p>One really important thing about the fluent API is that, in every step of the way, IntelliSense only shows us the relevant members:</p>
<p><a href="http://blogs.southworks.net/dschenkelman/files/2011/07/image.png"><img style="border-bottom: 0px;border-left: 0px;padding-left: 0px;padding-right: 0px;border-top: 0px;border-right: 0px;padding-top: 0px" border="0" alt="image" src="http://blogs.southworks.net/dschenkelman/files/2011/07/image_thumb.png" width="440" height="253" /></a></p>
<p><a href="http://blogs.southworks.net/dschenkelman/files/2011/07/image1.png"><img style="border-bottom: 0px;border-left: 0px;padding-left: 0px;padding-right: 0px;border-top: 0px;border-right: 0px;padding-top: 0px" border="0" alt="image" src="http://blogs.southworks.net/dschenkelman/files/2011/07/image_thumb1.png" width="530" height="188" /></a></p>
<h3>Transactional Operations</h3>
<p>The Commit() method call might have caught your eye in the previous code sample. This call is necessary, because Needle uses a transactional operation model. When performing a configuration operation with Needle, a committable object is created, which you must commit back to the container for the operation to take place. </p>
<p>This can also be useful in situations where you need to perform a certain configuration in a component, but want to wait until that configuration takes place. In this cases, keeping a reference to the <strong>ICommitable</strong> object until you want the configuration to take place does the trick.</p>
<h3>Each thing by its own name</h3>
<p>Let’s say we have another scenario, in which we could need either a Jedi or a Sith when requesting a force enlightened subject. In this case, the following code would do the trick:</p>
<code data-gist-id="5f417134279a7e3f584d" data-gist-file="Naming.cs"></code>
<p><font face="Helvetica">After that the container will have both mappings, which can be injected into another component using, for example, <a href="http://needlecontainer.codeplex.com/wikipage?title=Constructor%20Injection&amp;referringTitle=Documentation">Constructor</a> or <a href="http://needlecontainer.codeplex.com/wikipage?title=Property%20Injection&amp;referringTitle=Documentation">Property</a> injection.</font></p>
<h3>Lifetime Management</h3>
<p>In case we want to get the same Jedi instance each time we request a force enlightened subject, we can change the default lifetime registration from Transient (a different instance each time we request an <strong>IForceEnlightened</strong> subject)&#160; to Singleton (returns the same instance every time).</p>
<code data-gist-id="5f417134279a7e3f584d" data-gist-file="Lifetime.cs"></code>
<p>Singleton registrations are commonly used with services in most applications.</p>
<h3>Putting it all together</h3>
<p>Of course, we can both name and determine the scope of a registration. If we want fast and simple access to Master Yoda (and who doesn’t), we can name the mapping and set its lifetime to Singleton:</p>
<code data-gist-id="5f417134279a7e3f584d" data-gist-file="Everything.cs"></code>
<h3>Wrapping Up</h3>
<p>I hope you found this post fun, and that you try out Needle and its fluent API sometime. You can download Needle from <a href="http://needlecontainer.codeplex.com/releases/view/60894">here</a> or through Nuget:</p>
<pre class="brush: csharp;">PM&gt; Install-Package NeedleContainer</pre>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="http://localhost:4000/2011/06/26/binding-to-view-model-properties-in-data-templates-the-rootbinding-markup-extension/" class="btn" title="Binding to View Model properties in Data Templates. The RootBinding Markup Extension">Previous article</a>
      
      
        <a href="http://localhost:4000/2011/10/03/microsoft-media-platform-video-editor-former-rce-2-0-just-released/" class="btn" title="Microsoft Media Platform Video Editor (former RCE) 2.0 just released">Next article</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2014 Damian Schenkelman. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/so-simple/">So Simple Theme</a>.</span>
<div class="social-icons">
	<a href="http://twitter.com/dschenkelman" title="Damian Schenkelman on Twitter" target="_blank"><i class="icon-twitter icon-2x"></i></a>
	
	
	<a href="http://linkedin.com/in/damianschenkelman" title="Damian Schenkelman on LinkedIn" target="_blank"><i class="icon-linkedin icon-2x"></i></a>
	
	
	
	<a href="http://github.com/dschenkelman" title="Damian Schenkelman on Github" target="_blank"><i class="icon-github icon-2x"></i></a>
	
</div><!-- /.social-icons -->
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://localhost:4000/assets/js/scripts.min.js"></script>

<!-- Jekyll Simple Search option -->
<script>
  $(document).ready(function() {
      $('.search-field').simpleJekyllSearch({
          jsonFile : 'http://localhost:4000/search.json',
          searchResults : '.search-results',
          template : '<li><article><a href="{url}">{title} <span class="entry-date"><time datetime="{date}">{shortdate}</time></span></a></article></li>',
          noResults: '<p>Nothing found.</p>'
        });
  });

  (function( $, window, undefined ) {
    
     var bs = {
          close: $(".icon-remove-sign"),
          searchform: $(".search-form"),
          canvas: $("body"),
          dothis: $('.dosearch')
      };
    
    bs.dothis.on('click', function() {
      $('.search-wrapper').css({ display: "block" });
      bs.searchform.toggleClass('active');
      bs.searchform.find('input').focus();
      bs.canvas.toggleClass('search-overlay');
    });
    
      bs.close.on('click', function() {
        $('.search-wrapper').removeAttr( 'style' );
        bs.searchform.toggleClass('active');
        bs.canvas.removeClass('search-overlay');
    });
  })( jQuery, window );
</script>


	        

</body>
</html>
