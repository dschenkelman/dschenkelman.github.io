<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Developing application with WPF and Windows 7 (Part II) &#8211; A sea of code</title>
<meta name="description" content="Pseudo-random thoughts related to software development...">
<meta name="keywords" content="Disconnected Service Agent, DSA, p&amp;p, Patterns &amp; Practices, SCSF, Smart Client Software Factory, Windows 7, Windows 7 Taskbar, Windows Presentation Foundation, WPF">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://localhost:4000/images/site-logo.jpg">
<meta name="twitter:title" content="Developing application with WPF and Windows 7 (Part II)">
<meta name="twitter:description" content="Pseudo-random thoughts related to software development...">
<meta name="twitter:creator" content="@dschenkelman">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Developing application with WPF and Windows 7 (Part II)">
<meta property="og:description" content="Pseudo-random thoughts related to software development...">
<meta property="og:url" content="http://localhost:4000/2009/08/31/developing-application-with-wpf-and-windows-7-part-ii/">
<meta property="og:site_name" content="A sea of code">





<link rel="canonical" href="http://localhost:4000/2009/08/31/developing-application-with-wpf-and-windows-7-part-ii/">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="A sea of code Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.min.css">
<!-- Webfonts -->
<script src="//use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://localhost:4000/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/gist-embed/1.7/gist-embed.min.js"></script>

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
	        
			<li>
				
					<a href="http://localhost:4000/">Home</a>
				 
			</li>
	        
			<li>
				
					<a href="http://localhost:4000/about/">About</a>
				 
			</li>
	        
			<li>
				
					<a href="/articles/">Articles</a>
				 
			</li>
	        
	        <li><a href="http://localhost:4000/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
	        <li class="dosearch"><i class="icon-search"></i> Search</li>
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<div class="search-wrapper">
	<div class="search-form">
		<input type="text" class="search-field" placeholder="Search...">
		<i class="icon-remove-sign icon-2x"></i>
		<ul class="search-results post-list"></ul><!-- /.search-results -->
	</div><!-- /.search-form -->
</div><!-- ./search-wrapper -->

<header class="masthead">
	<div class="wrap">
        
    		<a href="http://localhost:4000/" class="site-logo" rel="home" title="A sea of code"><img src="http://localhost:4000/images/site-logo.jpg" width="200" height="200" alt="A sea of code logo" class="animated fadeInUp"></a>
        
        <h1 class="site-title animated fadeIn"><a href="http://localhost:4000/">A sea of code</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">Pseudo-random thoughts related to software development...</h2>
	</div>
</header><!-- /.masthead -->


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <span class="entry-tags"><a href="http://localhost:4000/tags/#Disconnected Service Agent" title="Pages tagged Disconnected Service Agent">Disconnected Service Agent</a>&nbsp;&bull;&nbsp;<a href="http://localhost:4000/tags/#DSA" title="Pages tagged DSA">DSA</a>&nbsp;&bull;&nbsp;<a href="http://localhost:4000/tags/#p&amp;p" title="Pages tagged p&amp;p">p&amp;p</a>&nbsp;&bull;&nbsp;<a href="http://localhost:4000/tags/#Patterns &amp; Practices" title="Pages tagged Patterns &amp; Practices">Patterns &amp; Practices</a>&nbsp;&bull;&nbsp;<a href="http://localhost:4000/tags/#SCSF" title="Pages tagged SCSF">SCSF</a>&nbsp;&bull;&nbsp;<a href="http://localhost:4000/tags/#Smart Client Software Factory" title="Pages tagged Smart Client Software Factory">Smart Client Software Factory</a>&nbsp;&bull;&nbsp;<a href="http://localhost:4000/tags/#Windows 7" title="Pages tagged Windows 7">Windows 7</a>&nbsp;&bull;&nbsp;<a href="http://localhost:4000/tags/#Windows 7 Taskbar" title="Pages tagged Windows 7 Taskbar">Windows 7 Taskbar</a>&nbsp;&bull;&nbsp;<a href="http://localhost:4000/tags/#Windows Presentation Foundation" title="Pages tagged Windows Presentation Foundation">Windows Presentation Foundation</a>&nbsp;&bull;&nbsp;<a href="http://localhost:4000/tags/#WPF" title="Pages tagged WPF">WPF</a></span>
        
          <h1 class="entry-title">Developing application with WPF and Windows 7 (Part II)</h1>
        
      </header>
      <footer class="entry-meta">
        <img src="http://localhost:4000/images/bio-photo.jpg" alt="Damian Schenkelman photo" class="author-photo">
        <span class="author vcard">By <span class="fn"><a href="http://localhost:4000/about/" title="About Damian Schenkelman">Damian Schenkelman</a></span></span>
        <span class="entry-date date published"><time datetime="2009-08-31T00:00:00-04:00"><i class="icon-calendar-empty"></i> August 31, 2009</time></span>
        
        
        <span><a href="http://localhost:4000/2009/08/31/developing-application-with-wpf-and-windows-7-part-ii/" rel="bookmark" title="Developing application with WPF and Windows 7 (Part II)"><i class="icon-link"></i> Permalink</a></span>
        
      </footer>
      <div class="entry-content">
        <p>In my <a href="http://blogs.southworks.net/dschenkelman/2009/08/11/developing-applications-with-wpf-and-windows-7-part-i/">previous post</a> I talked about how to integrate some of the Windows 7 features (specifically Overlay Images and Taskbar Progress) in a WPF application we created for a <a href="http://www.mslatam.com/latam/mediacenter/default.aspx?v=4c66302e-e87b-4a83-bb4a-caacbd22a563">screencast (in Spanish)</a>. In this post I will go over the remaining features I have yet to cover. These are:</p>
<ul>
<li>How to: Show a thumbnail of the application</li>
<li>How to: Use Thumbnail Toolbar buttons</li>
<li>How to: Open a new application with the Jumplist</li>
</ul>
<p>Last time we ended up with <a href="http://cid-09f63fc7ac065e5e.skydrive.live.com/self.aspx/MSDN%20|0%20Technet/SnowShopPart1.zip">this application</a>, so you might be interested in downloading it, since all changes shown in this post will be done to it.</p>
<h2>How to: Show a thumbnail of the application</h2>
<p>One of the cool features in <a href="http://www.microsoft.com/windows/windows-7/default.aspx">Windows 7</a>, is that you can show a clipped thumbnail preview of your application instead of one for the entire window. We thought our application was identified by snowboards, so we decided to show the selected snowboard in the taskbar preview.</p>
<p>To set the custom preview, we are going to need the Window's handle. However, as WPF Windows do not have a handle, we are going to add the following code in the <strong>Shell.xaml</strong> codebehind:</p>
<pre><span style="color: blue">private </span><span style="color: #2b91af">IntPtr </span>handle;
        <span style="color: blue">public </span><span style="color: #2b91af">IntPtr </span>Handle
        {
            <span style="color: blue">get
            </span>{
                <span style="color: blue">if </span>(<span style="color: blue">this</span>.handle == <span style="color: #2b91af">IntPtr</span>.Zero)
                {
                    <span style="color: #2b91af">WindowInteropHelper </span>interopHelper = <span style="color: blue">new </span><span style="color: #2b91af">WindowInteropHelper</span>(<span style="color: blue">this</span>);
                    <span style="color: blue">this</span>.handle = interopHelper.Handle;
                }

                <span style="color: blue">return this</span>.handle;
            }
        }</pre>
<p><a href="http://11011.net/software/vspaste"></a>After that, we can add code like this in the Shell Load to clip our window and show the desired part of it:</p>
<pre><span style="color: blue">private void </span>Shell_OnLoad(<span style="color: blue">object </span>sender, <span style="color: #2b91af">RoutedEventArgs </span>e)
        {
            <span style="color: blue">this</span>.InitializeConnectionMonitor();
            <span style="color: blue">this</span>.InitializeRequestManager();
            <span style="color: blue">this</span>.InitializeServiceAgent();

            <span style="color: #2b91af">Rectangle </span>clippingRect = <span style="color: blue">new </span><span style="color: #2b91af">Rectangle</span>(
             <span style="color: blue">new </span>System.Drawing.<span style="color: #2b91af">Point</span>(552, 89),
             <span style="color: blue">new </span>System.Drawing.<span style="color: #2b91af">Size</span>(210, 310));

            <span style="color: #2b91af">Taskbar</span>.TabbedThumbnail.SetThumbnailClip(<span style="color: blue">this</span>.Handle, clippingRect);
        }</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p>As you can see, we hardcoded the values to clip the rectangle. However, you can simply calculate to obtain code that will work in any display.</p>
<p>If you run the application you should be able to see a small preview of the board when hovering over the application in the taskbar.</p>
<table border="1" cellspacing="0" cellpadding="2" width="660">
<tbody>
<tr>
<td width="658" valign="top"><strong>Note: </strong>The thumbnail custom preview might not be visible in all versions of Windows 7. Running in VPC environment it also does not work.</td>
</tr>
</tbody>
</table>
<h2>How to: Use Thumbnail Toolbar buttons</h2>
<p>Thumbnail buttons are a really useful feature, because they allow you to execute different operations in your application without even having to open it. For the snowshop scenario we decided to add two buttons, one that would pick the next snowboard and another one for the previous.</p>
<p>We first  need to define both buttons for the entire scope of the Shell.xaml class:</p>
<pre><span style="color: blue">        private readonly </span><span style="color: #2b91af">ThumbnailButton </span>buttonPrevious;
        <span style="color: blue">private readonly </span><span style="color: #2b91af">ThumbnailButton </span>buttonNext;</pre>
<p>In the Shell's constructor we create the buttons and assign their respective icons:</p>
<pre><span style="color: blue">        public </span>Shell()
        {
            <span style="color: blue">this</span>.InitializeComponent();

            <span style="color: blue">this</span>.buttonNext = <span style="color: blue">new </span><span style="color: #2b91af">ThumbnailButton</span>(<span style="color: blue">new </span><span style="color: #2b91af">Icon</span>(<span style="color: #a31515">"images\nextArrow.ico"</span>), <span style="color: #a31515">"Next Image"</span>);
            <span style="color: blue">this</span>.buttonPrevious = <span style="color: blue">new </span><span style="color: #2b91af">ThumbnailButton</span>(<span style="color: blue">new </span><span style="color: #2b91af">Icon</span>(<span style="color: #a31515">"images\prevArrow.ico"</span>), <span style="color: #a31515">"Previous Image"</span>);
        }</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p>Now we have to handle the click event of the buttons and add them. We placed this code in the Shell Load handler:</p>
<pre><span style="color: blue">private void </span>Shell_OnLoad(<span style="color: blue">object </span>sender, <span style="color: #2b91af">RoutedEventArgs </span>e)
       {
           <span style="color: blue">this</span>.InitializeConnectionMonitor();
           <span style="color: blue">this</span>.InitializeRequestManager();
           <span style="color: blue">this</span>.InitializeServiceAgent();

           <span style="color: #2b91af">Rectangle </span>clippingRect = <span style="color: blue">new </span><span style="color: #2b91af">Rectangle</span>(
            <span style="color: blue">new </span>System.Drawing.<span style="color: #2b91af">Point</span>(552, 89),
            <span style="color: blue">new </span>System.Drawing.<span style="color: #2b91af">Size</span>(210, 310));

           <span style="color: #2b91af">Taskbar</span>.TabbedThumbnail.SetThumbnailClip(<span style="color: blue">this</span>.Handle, clippingRect);

           <span style="color: blue">this</span>.buttonNext.Click += <span style="color: blue">this</span>.ButtonNext_Click;
           <span style="color: blue">this</span>.buttonPrevious.Click += <span style="color: blue">this</span>.ButtonPrevious_Click;

           <span style="color: #2b91af">Taskbar</span>.ThumbnailToolbars.AddButtons(<span style="color: blue">this</span>.Handle, <span style="color: blue">this</span>.buttonPrevious, <span style="color: blue">this</span>.buttonNext);
       }</pre>
<p><a href="http://11011.net/software/vspaste"></a>As you might have noticed, the handlers for the events are yet to be written, so let's get to it:</p>
<pre><span style="color: blue">private void </span>ButtonPrevious_Click(<span style="color: blue">object </span>sender, <span style="color: #2b91af">EventArgs </span>e)
        {
            <span style="color: blue">int </span>newIndex = BoardList.SelectedIndex - 1;

            <span style="color: blue">if </span>(newIndex &gt; -1)
            {
                <span style="color: blue">this</span>.BoardList.SelectedIndex = newIndex;
            }
        }

        <span style="color: blue">private void </span>ButtonNext_Click(<span style="color: blue">object </span>sender, <span style="color: #2b91af">EventArgs </span>e)
        {
            <span style="color: blue">int </span>newIndex = BoardList.SelectedIndex + 1;

            <span style="color: blue">if </span>(newIndex &lt; BoardList.Items.Count)
            {
                <span style="color: blue">this</span>.BoardList.SelectedIndex = newIndex;
            }
        }</pre>
<p><a href="http://11011.net/software/vspaste"></a>But we also want to disable the <strong>Previous</strong> button when standing in the first board, and disable the <strong>Next</strong> button when the last board is selected. This can be easiliy achieved by adding the event handler declaration in XAML:</p>
<pre><span style="color: blue">&lt;</span><span style="color: #a31515">ListBox </span><span style="color: red">x</span><span style="color: blue">:</span><span style="color: red">Name</span><span style="color: blue">="BoardList" </span><span style="color: red">ItemsSource</span><span style="color: blue">="{</span><span style="color: #a31515">Binding </span><span style="color: red">Source</span><span style="color: blue">={</span><span style="color: #a31515">StaticResource </span><span style="color: red">SnowboardTables</span><span style="color: blue">}}"
      </span><span style="color: red">IsSynchronizedWithCurrentItem</span><span style="color: blue">="True" </span><span style="color: red">Style</span><span style="color: blue">="{</span><span style="color: #a31515">StaticResource </span><span style="color: red">BoardListStyle</span><span style="color: blue">}" </span><span style="color: red">SelectionChanged</span><span style="color: blue">="BoardList_SelectionChanged"/&gt;</span></pre>
<p><a href="http://11011.net/software/vspaste"></a>And writing code like this for the handler:</p>
<pre><span style="color: blue">private void </span>BoardList_SelectionChanged(<span style="color: blue">object </span>sender, System.Windows.Controls.<span style="color: #2b91af">SelectionChangedEventArgs </span>e)
       {
          <span style="color: blue">this</span>.buttonPrevious.Enabled = <span style="color: blue">this</span>.BoardList.SelectedIndex &gt; 0;
          <span style="color: blue">this</span>.buttonNext.Enabled = <span style="color: blue">this</span>.BoardList.SelectedIndex &lt; BoardList.Items.Count - 1;
       }</pre>
<p>As you can see adding code to interact with your applcation via Thumbnail Toolbar buttons is really straightforward, and if you press F5, you should be able to see the Snowboard in the Thumbnail preview spinning as your press the different thumbnail buttons to change the boards.</p>
<p>You can see an image below with the outcome of the application after both additions (Thumbnail Toolbar Buttons and Thumbnail image).</p>
<p><img src="http://blogs.southworks.net/ejadib/files/2009/08/image.png" alt="" width="539" height="480" /></p>
<h2>How to: Open a new application with the Jumplist</h2>
<p>As you might have noticed the application allows you to sell more than one board at the same time, but it does not provide the total price of the purchase. That is why a feature that might come in handy is having the windows calculator launched from the application's <a href="http://windows.microsoft.com/en-us/windows7/products/features/jump-lists">Jumplist</a> . The <a href="http://windows.microsoft.com/en-us/windows7/products/features/jump-lists">Jumplist</a> is like the application's start menu, and many useful features can be implemented with it.</p>
<p>To use the Windows 7 Jumplist in your application, you first have to set the application's ID, which is the unique identifier of your application (it is a string). The following code, which should be placed in the App.xaml file, will add a link to the calculator in the SnowShop's jumplist:</p>
<pre><span style="color: blue">protected override void </span>OnStartup(System.Windows.<span style="color: #2b91af">StartupEventArgs </span>e)
       {
           <span style="color: #2b91af">Taskbar</span>.AppId = <span style="color: #2b91af">Settings</span>.Default.AppID;
           JumpList jumpList = <span style="color: #2b91af">Taskbar</span>.JumpList;

           <span style="color: #2b91af">CustomCategory </span>helperCategory = <span style="color: blue">new </span><span style="color: #2b91af">CustomCategory</span>(<span style="color: #a31515">"Shop Helpers"</span>);
           jumpList.CustomCategories.Add(helperCategory);

           <span style="color: #2b91af">JumpListLink </span>taskBarLink = <span style="color: blue">new </span><span style="color: #2b91af">JumpListLink</span>();
           taskBarLink.Title = <span style="color: #a31515">"Run Calculator"</span>;
           taskBarLink.Path = <span style="color: #a31515">@"%windir%\system32\calc.exe"</span>;

           helperCategory.JumpListItems.Add(taskBarLink);
           jumpList.RefreshTaskbarList();

           <span style="color: blue">base</span>.OnStartup(e);
       }</pre>
<h3>Outcome</h3>
<p>You can download the code for the entire demo (including all the modifications explained in this post) from the link below.</p>
<h6>Disclaimer</h6>
<p>This code is provided “AS IS” with no warranties, and confers no rights.</p>
<h6>Download</h6>
<p>You can get source code here: <a href="http://cid-99e3cd967baf3dc7.skydrive.live.com/self.aspx/MSDN%20|0%20TechNet/Windows%207x7/SnowShopW7.zip">SnowShopW7.zip</a>.</p>
<p>I hope this couple of posts were useful for you when developing with WPF and Windows 7.</p>
<p><a href="http://11011.net/software/vspaste"></a></p>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="http://localhost:4000/2009/08/13/c-code-snippet-to-create-commands-with-attached-behaviors-using-prism/" class="btn" title="C# Code Snippet to Create Commands with Attached Behaviors using Prism">Previous article</a>
      
      
        <a href="http://localhost:4000/2009/09/07/composite-application-guidance-for-wpf-sl-prism-v2-c-snippets-with-guidance-links-and-tips/" class="btn" title="Composite Application Guidance for WPF & SL (Prism-v2) C# Snippets with Guidance, Links and Tips">Next article</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2014 Damian Schenkelman. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/so-simple/">So Simple Theme</a>.</span>
<div class="social-icons">
	<a href="http://twitter.com/dschenkelman" title="Damian Schenkelman on Twitter" target="_blank"><i class="icon-twitter icon-2x"></i></a>
	
	
	<a href="http://linkedin.com/in/damianschenkelman" title="Damian Schenkelman on LinkedIn" target="_blank"><i class="icon-linkedin icon-2x"></i></a>
	
	
	
	<a href="http://github.com/dschenkelman" title="Damian Schenkelman on Github" target="_blank"><i class="icon-github icon-2x"></i></a>
	
</div><!-- /.social-icons -->
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://localhost:4000/assets/js/scripts.min.js"></script>

<!-- Jekyll Simple Search option -->
<script>
  $(document).ready(function() {
      $('.search-field').simpleJekyllSearch({
          jsonFile : 'http://localhost:4000/search.json',
          searchResults : '.search-results',
          template : '<li><article><a href="{url}">{title} <span class="entry-date"><time datetime="{date}">{shortdate}</time></span></a></article></li>',
          noResults: '<p>Nothing found.</p>'
        });
  });

  (function( $, window, undefined ) {
    
     var bs = {
          close: $(".icon-remove-sign"),
          searchform: $(".search-form"),
          canvas: $("body"),
          dothis: $('.dosearch')
      };
    
    bs.dothis.on('click', function() {
      $('.search-wrapper').css({ display: "block" });
      bs.searchform.toggleClass('active');
      bs.searchform.find('input').focus();
      bs.canvas.toggleClass('search-overlay');
    });
    
      bs.close.on('click', function() {
        $('.search-wrapper').removeAttr( 'style' );
        bs.searchform.toggleClass('active');
        bs.canvas.removeClass('search-overlay');
    });
  })( jQuery, window );
</script>


	        

</body>
</html>
