<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Developing applications with WPF and Windows 7 (Part I) &#8211; A sea of code</title>
<meta name="description" content="Pseudo-random thoughts related to software development...">
<meta name="keywords" content="Disconnected Service Agent, DSA, p&amp;p, Patterns &amp; Practices, SCSF, Smart Client Software Factory, Windows 7, Windows 7 Taskbar, Windows Presentation Foundation, WPF">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/site-logo.jpg">
<meta name="twitter:title" content="Developing applications with WPF and Windows 7 (Part I)">
<meta name="twitter:description" content="Pseudo-random thoughts related to software development...">
<meta name="twitter:creator" content="@dschenkelman">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Developing applications with WPF and Windows 7 (Part I)">
<meta property="og:description" content="Pseudo-random thoughts related to software development...">
<meta property="og:url" content="/2009/08/11/developing-applications-with-wpf-and-windows-7-part-i/">
<meta property="og:site_name" content="A sea of code">





<link rel="canonical" href="/2009/08/11/developing-applications-with-wpf-and-windows-7-part-i/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="A sea of code Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.min.css">
<!-- Webfonts -->
<script src="//use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">j

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
	        
			<li>
				
					<a href="/">Home</a>
				 
			</li>
	        
			<li>
				
					<a href="/about/">About</a>
				 
			</li>
	        
			<li>
				
					<a href="/articles/">Articles</a>
				 
			</li>
	        
	        <li><a href="/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
	        <li class="dosearch"><i class="icon-search"></i> Search</li>
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<div class="search-wrapper">
	<div class="search-form">
		<input type="text" class="search-field" placeholder="Search...">
		<i class="icon-remove-sign icon-2x"></i>
		<ul class="search-results post-list"></ul><!-- /.search-results -->
	</div><!-- /.search-form -->
</div><!-- ./search-wrapper -->

<header class="masthead">
	<div class="wrap">
        
    		<a href="/" class="site-logo" rel="home" title="A sea of code"><img src="/images/site-logo.jpg" width="200" height="200" alt="A sea of code logo" class="animated fadeInUp"></a>
        
        <h1 class="site-title animated fadeIn"><a href="/">A sea of code</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">Pseudo-random thoughts related to software development...</h2>
	</div>
</header><!-- /.masthead -->


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <span class="entry-tags"><a href="/tags/#Disconnected Service Agent" title="Pages tagged Disconnected Service Agent">Disconnected Service Agent</a>&nbsp;&bull;&nbsp;<a href="/tags/#DSA" title="Pages tagged DSA">DSA</a>&nbsp;&bull;&nbsp;<a href="/tags/#p&amp;p" title="Pages tagged p&amp;p">p&amp;p</a>&nbsp;&bull;&nbsp;<a href="/tags/#Patterns &amp; Practices" title="Pages tagged Patterns &amp; Practices">Patterns &amp; Practices</a>&nbsp;&bull;&nbsp;<a href="/tags/#SCSF" title="Pages tagged SCSF">SCSF</a>&nbsp;&bull;&nbsp;<a href="/tags/#Smart Client Software Factory" title="Pages tagged Smart Client Software Factory">Smart Client Software Factory</a>&nbsp;&bull;&nbsp;<a href="/tags/#Windows 7" title="Pages tagged Windows 7">Windows 7</a>&nbsp;&bull;&nbsp;<a href="/tags/#Windows 7 Taskbar" title="Pages tagged Windows 7 Taskbar">Windows 7 Taskbar</a>&nbsp;&bull;&nbsp;<a href="/tags/#Windows Presentation Foundation" title="Pages tagged Windows Presentation Foundation">Windows Presentation Foundation</a>&nbsp;&bull;&nbsp;<a href="/tags/#WPF" title="Pages tagged WPF">WPF</a></span>
        
          <h1 class="entry-title">Developing applications with WPF and Windows 7 (Part I)</h1>
        
      </header>
      <footer class="entry-meta">
        <img src="/images/bio-photo.jpg" alt="Damian Schenkelman photo" class="author-photo">
        <span class="author vcard">By <span class="fn"><a href="/about/" title="About Damian Schenkelman">Damian Schenkelman</a></span></span>
        <span class="entry-date date published"><time datetime="2009-08-11T00:00:00-04:00"><i class="icon-calendar-empty"></i> August 11, 2009</time></span>
        
        <span class="entry-comments"><i class="icon-comment-alt"></i> <a href="#disqus_thread">Comment</a></span>
        <span><a href="/2009/08/11/developing-applications-with-wpf-and-windows-7-part-i/" rel="bookmark" title="Developing applications with WPF and Windows 7 (Part I)"><i class="icon-link"></i> Permalink</a></span>
        
      </footer>
      <div class="entry-content">
        <p>Last week with <a href="http://blogs.southworks.net/mwoloski/2009/08/11/windows-7-screencast-taskbar-overlayimage-progressbar-thumbnails/">Matias Woloski</a> and <a href="http://blogs.southworks.net/ejadib/2009/08/10/wpf-windows-7-screencast/">Ezequiel Jadib</a> we created a demo for a <a href="http://www.mslatam.com/latam/mediacenter/default.aspx?v=4c66302e-e87b-4a83-bb4a-caacbd22a563">screencast (in Spanish)</a> that shows how to take advantage of  some <a href="http://windows.microsoft.com/en-US/windows7/products/features">Windows 7 features</a> in a <a href="http://windowsclient.net/wpf/default.aspx">WPF</a> application, improving the user experience (after all that is one of the main goals of WPF). You can find the code for the clean application (without Windows 7 functionality) <a href="http://cid-09f63fc7ac065e5e.skydrive.live.com/self.aspx/MSDN%20%7C0%20Technet/SnowShopW7Clean.zip">here</a>, and the fully functional application <a href="http://cid-99e3cd967baf3dc7.skydrive.live.com/self.aspx/MSDN%20%7C0%20TechNet/Windows%207x7/SnowShopW7.zip">over here</a>. In this and <a href="http://blogs.southworks.net/dschenkelman/2009/08/31/developing-application-with-wpf-and-windows-7-part-ii/">future posts</a> I will go over the relevant additions to the application, so you can see how easy it is to take advantage of Windows 7 features in your existing application. At the end of each post I will provide the outcome solution.</p>
<h4>Demo Scenario</h4>
<p>The application shows a Snow Board Shop that allows to Ship Orders of different Snow Boards. It also provides support for temporarily connected scenarios using the <a href="http://blogs.southworks.net/dschenkelman/2008/08/04/dsa-application-block-overview/">Disconnected Service Agent Application Block</a> from the <a href="http://msdn.microsoft.com/en-us/library/aa480482.aspx">Smart Client Software Factory</a>.<br />
<a href="http://blogs.southworks.net/dschenkelman/files/2009/08/snowshop.png"><img class="aligncenter size-full wp-image-119" src="http://blogs.southworks.net/dschenkelman/files/2009/08/snowshop.png" alt="Snowshop" width="500" height="379" align="center" /></a><br />
The demo shows the following interaction with Windows 7:</p>
<ul>
<li>How to: Show connectivity status in the Windows 7 Taskbar [in this post]</li>
<li>How to: Show progress while shipping orders [in this post]</li>
<li>How to: Show a thumbnail of the application [coming soon]</li>
<li>How to: Use Thumbnail buttons [coming soon]</li>
<li>How to: Open a new application with the Jumplist [coming soon]</li>
</ul>
<h4>Implementation Details</h4>
<ul>
<li>The demo leverages Windows 7 functionalities through the Microsoft.WindowsAPICodePack.dll and Microsoft.WindowsAPICodePack.Shell.dll. Downloaded from <a href="http://code.msdn.microsoft.com/WindowsAPICodePack">here</a> (WindowsAPICodePack).</li>
</ul>
<h4>How to: Show connectivity status in the Taskbar</h4>
<p>What we wanted to do is show whether the application is connected to the internet (which would in turn enable it to ship orders), without having the window open. What we decided to do is show an icon in the application's taskbar that reflect the connectivity status. To do this, we must first add a reference to System.Drawing.dll and to both assemblies mentioned above (located in the <strong>Lib</strong> folder). Then, update the <strong>UpdateConnectionStatus </strong>method to change the icon based on the status:</p>
<pre><span style="color: blue">private void </span>UpdateConnectionStatus(<span style="color: blue">bool </span>isConnected)
        {
            <span style="color: blue">string </span>status;
            <span style="color: #2b91af">Icon </span>icon;

            <span style="color: blue">if </span>(isConnected)
            {
                status = <span style="color: #a31515">"Online"</span>;
                icon = <span style="color: blue">new </span><span style="color: #2b91af">Icon</span>(<span style="color: #a31515">"images\Available.ico"</span>);

                StatusLabel.Style = (<span style="color: #2b91af">Style</span>)FindResource(<span style="color: #a31515">"StatusLabelOnline"</span>);
                StatusLabel.Content = status;
            }
            <span style="color: blue">else
            </span>{
                status = <span style="color: #a31515">"Offline"</span>;
                icon = <span style="color: blue">new </span><span style="color: #2b91af">Icon</span>(<span style="color: #a31515">"images\Offline.ico"</span>);

                StatusLabel.Style = (<span style="color: #2b91af">Style</span>)FindResource(<span style="color: #a31515">"StatusLabelOffline"</span>);
                StatusLabel.Content = status;
            }

            <span style="color: #2b91af">Taskbar</span>.OverlayImage.Icon = icon;
            <span style="color: #2b91af">Taskbar</span>.OverlayImage.Text = status;
        }</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p>If you run the application now and connect/disconnect from the Internet, you will notice the icon in the Taskbar changing.</p>
<p><a href="http://blogs.southworks.net/dschenkelman/files/2009/08/connectivity.png"><img class="aligncenter size-full wp-image-124" src="http://blogs.southworks.net/dschenkelman/files/2009/08/connectivity.png" alt="Taskbar Connectivity" width="500" height="107" /></a></p>
<h4>How to: Show progress while shipping orders</h4>
<p>Now that we are able to show connectivity, and are working in a scenario with Offline capabilities it would be good to show the progress of the orders being dispatched without having the application's window open. That's when the Windows 7 taskbar comes to the rescue. Our goal is to show progress, by increasing the progress value as less orders are pending to dispatch. All we have to do is update the handlers of the RequestDispatched and RequestEnqueued events with code like this:</p>
<pre><span style="color: blue">private delegate void </span><span style="color: #2b91af">OnRequestEnqueuedDelegate</span>(<span style="color: blue">object </span>sender, RequestEnqueuedEventArgs e);
      <span style="color: blue">private void </span>OnRequestEnqueued(<span style="color: blue">object </span>sender, RequestEnqueuedEventArgs e)
      {
          <span style="color: blue">this</span>.UpdateRequestQueue();
          <span style="color: blue">if </span>(Dispatcher.Thread != System.Threading.<span style="color: #2b91af">Thread</span>.CurrentThread)
          {
              Dispatcher.Invoke(<span style="color: blue">new </span><span style="color: #2b91af">OnRequestEnqueuedDelegate</span>(OnRequestEnqueued), sender, e);
          }
          <span style="color: blue">else
          </span>{
              <span style="color: green">//Start showing progress when the first request is enqueued
              </span><span style="color: blue">if </span>(manager.RequestQueue.GetCount() == 1)
                  <span style="color: #2b91af">Taskbar</span>.ProgressBar.State = TaskbarButtonProgressState.Indeterminate;

              <span style="color: #2b91af">Taskbar</span>.ProgressBar.MaxValue = manager.RequestQueue.GetCount();
              <span style="color: #2b91af">Taskbar</span>.ProgressBar.CurrentValue = 0;
          }

      }

      <span style="color: blue">private delegate void </span><span style="color: #2b91af">OnRequestDispatchedDelegate</span>(<span style="color: blue">object </span>sender, RequestDispatchedEventArgs e);
      <span style="color: blue">private void </span>OnRequestDispatched(<span style="color: blue">object </span>sender, RequestDispatchedEventArgs e)
      {
          <span style="color: blue">this</span>.UpdateRequestQueue();
          <span style="color: blue">if </span>(Dispatcher.Thread != System.Threading.<span style="color: #2b91af">Thread</span>.CurrentThread)
          {
              Dispatcher.Invoke(<span style="color: blue">new </span><span style="color: #2b91af">OnRequestDispatchedDelegate</span>(OnRequestDispatched), sender, e);
          }
          <span style="color: blue">else
          </span>{   <span style="color: green">//Stop showing progress when there are no more requests
              </span><span style="color: blue">if </span>(manager.RequestQueue.GetCount() == 0)
              {
                  <span style="color: #2b91af">Taskbar</span>.ProgressBar.State = TaskbarButtonProgressState.NoProgress;
              }
              <span style="color: blue">else
              </span>{
                  <span style="color: #2b91af">Taskbar</span>.ProgressBar.State = TaskbarButtonProgressState.Normal;
                  <span style="color: #2b91af">Taskbar</span>.ProgressBar.CurrentValue += 1;
              }
          }
      }</pre>
<p>To be able to see how this works, I would recommend disconnecting from the Internet (so no orders are dispatched) and enqueuing about 20 orders. Then connect, and you will be able to see the progress bar increasing as orders are dispatched.</p>
<p><a href="http://blogs.southworks.net/dschenkelman/files/2009/08/progress.png"><img class="aligncenter size-medium wp-image-125" src="http://blogs.southworks.net/dschenkelman/files/2009/08/progress.png" alt="Taskbar Progress" width="300" height="100" /></a></p>
<h4>Outcome</h4>
<h6>Disclaimer</h6>
<p>This code is provided “AS IS” with no warranties, and confers no rights.</p>
<h6>Download</h6>
<p>You can get source code here: <a href="http://cid-09f63fc7ac065e5e.skydrive.live.com/self.aspx/MSDN%20%7C0%20Technet/SnowShopPart1.zip">SnowShopPart1.zip</a>.</p>
<p>Stay tuned because I will blog about all the other features soon :) .</p>
<p>EDIT August 31st 2009: <a href="http://blogs.southworks.net/dschenkelman/2009/08/31/developing-application-with-wpf-and-windows-7-part-ii/">Blogged part 2</a>.</p>

        <div id="disqus_thread"></div><!-- /#disqus_thread -->
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="/2009/08/09/how-to-populate-the-module-catalog-from-xaml-in-a-wpf-application-using-the-composite-application-guidance-for-wpf-silverlight-prism-v2/" class="btn" title="How to: Populate the Module Catalog from XAML in a WPF application using the Composite Application Guidance for WPF & Silverlight (Prism-v2)">Previous article</a>
      
      
        <a href="/2009/08/13/c-code-snippet-to-create-commands-with-attached-behaviors-using-prism/" class="btn" title="C# Code Snippet to Create Commands with Attached Behaviors using Prism">Next article</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2014 Damian Schenkelman. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/so-simple/">So Simple Theme</a>.</span>
<div class="social-icons">
	<a href="http://twitter.com/dschenkelman" title="Damian Schenkelman on Twitter" target="_blank"><i class="icon-twitter icon-2x"></i></a>
	
	
	<a href="http://linkedin.com/in/damianschenkelman" title="Damian Schenkelman on LinkedIn" target="_blank"><i class="icon-linkedin icon-2x"></i></a>
	
	
	
	<a href="http://github.com/dschenkelman" title="Damian Schenkelman on Github" target="_blank"><i class="icon-github icon-2x"></i></a>
	
</div><!-- /.social-icons -->
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/gist-embed/1.7/gist-embed.min.js"></script>


<!-- Jekyll Simple Search option -->
<script>
  $(document).ready(function() {
      $('.search-field').simpleJekyllSearch({
          jsonFile : '/search.json',
          searchResults : '.search-results',
          template : '<li><article><a href="{url}">{title} <span class="entry-date"><time datetime="{date}">{shortdate}</time></span></a></article></li>',
          noResults: '<p>Nothing found.</p>'
        });
  });

  (function( $, window, undefined ) {

     var bs = {
          close: $(".icon-remove-sign"),
          searchform: $(".search-form"),
          canvas: $("body"),
          dothis: $('.dosearch')
      };

    bs.dothis.on('click', function() {
      $('.search-wrapper').css({ display: "block" });
      bs.searchform.toggleClass('active');
      bs.searchform.find('input').focus();
      bs.canvas.toggleClass('search-overlay');
    });

      bs.close.on('click', function() {
        $('.search-wrapper').removeAttr( 'style' );
        bs.searchform.toggleClass('active');
        bs.canvas.removeClass('search-overlay');
    });
  })( jQuery, window );
</script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-50875301-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'dschenkelman'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	        

</body>
</html>
